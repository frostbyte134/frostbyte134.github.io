---
layout: post
title:  "ElasticSearch"
date:   2021-06-26 08:00:05 +0800
categories: coding
use_math: true
tags: coding logging
---

> 기초부터 다지는 ElasticSearch 운영 노하우

### 용어정리
- 인덱스 : 문서의 가장 큰 단위
- 스키마 : mapping정보
- 색인 : indexing. 문서를  검색가능하게 저장


### 1장 ES란
 
- `Lucene`기반의 오픈소스 검색엔진
- json기반 문서 저장, 검색, 분석
- 준실시간 = 1초단위 응답. `refresh_interval` param에 영향 받음
- 스키마리스 : 입력데이터에 기반해 스키마 자동 생성 (conflict나면 저장안함)
  - __미리 스키마를 정의하지 않아도 동적으로 정의할 수 있다__
- 클러스터는 메시형태 : 어떤 노드에서도 색인/검색 처리가능?
  - 마스터노드는 있으나 메타데이터, 상태 등 관리
  - 특정샤드가 없는 노드에선 특정인덱스 검색이 안되지 않나?
- rest api기반. `PUT` : 생성, `POST` : 수정


### 2장 ES 기본 동작

문서색인
- `curl -X PUT addr/<index_name>/<type>/<id>?pretty -d {json}`
- ES 버전 5이하에서는 인덱스 내에 다른 타입 저장가능했지만 이젠 안됨
- 색인요청시
  - 인덱스가 없으면 만듬
  - 타입이 없어도 만듬
  - 스키마가 없어도 만듬
  - 스키마 충돌체크 수행

문서검색, 분석 (aggregation) : 스킵 (책 ㄱㄱ)

### 3장 모니터링
- heads, 프로메테우스, 그라파나, x-pack


### 4장 ES 개본개념
클러스터, 노드
- ES클러스터는 __이름, UUID를__ 가짐. 이 pair로 노드들이 서로 동일한 클러스터임을 인식하고 클러스터링됨
- 노드도 이름/UUID를 가짐
- 노드의 종류
  - 마스터 : 클러스터 상태, 메타데이터 등 저장
  - 데이터 : 문서를 인덱스에 저장
  - 인제스트 : 문서 저장 전 문서 내용을 사전 처리하는 노드
  - 코디네이트 : 사용자요청을 데이터노드로 전달하고, 결과를 취합